<extend name="Common/base"/>
<block name="style">
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/fileupload/css/jquery.fileupload.css" media="all">
    <style>
        .am-table {
            font-size: 1.3rem;
            margin-bottom: 0;
        }
        .am-btn{
            padding:5px 15px;font-size:12px
        }
    </style>
</block>

<block name="body">
    <!-- 内容区域 -->
    <div class="row-content am-cf">
        <div class="row">
            <div class="widget am-cf">
                <div class="widget-head am-cf">
                    <div class="widget-title  am-cf">{$info['id'] ? '编辑' : '新增'}简历</div>
                </div>
                <div class="widget-body  am-fr">
                    <form id="orderForm" action="__ACTION__" method="post" class="ajaxForm">
                    <table width="100%" class="am-table am-table-bordered">
                        <thead>
                            <tr><th colspan="4">基本信息</th></tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td width="25%"><div align="right"><em class="must-input">*</em><strong>真实姓名：</strong></div></td>
                                <td colspan="3"><input type="text" id="true_name" name="true_name" value="{$info['true_name']}"  placeholder="请输入真实姓名"/></td>
                            </tr>
                            <tr>
                                <td><div align="right"><em class="must-input">*</em><strong>手机号：</strong></div></td>
                                <td colspan="3"><input type='tel' maxlength="11" id="mobile" name="mobile" value="{$info['mobile']}"  placeholder="请输入手机号" /></td>
                            </tr>
                            <tr>
                                <td><div align="right"><em class="must-input">*</em><strong>电子邮箱：</strong></div></td>
                                <td colspan="3"><input type="email" id="email" name="email" value="{$info['email']}" style="width:500px" placeholder="请输入电子邮箱" /></td>
                            </tr>
                            <tr>
                                <td><div align="right"><em class="must-input">*</em><strong>年龄：</strong></div></td>
                                <td colspan="3"><input type="text" id="age" name="age" value="{$info['age']|date='Y-m-d', ###}" style="width:500px" placeholder="请选择年龄" /></td>
                            </tr>
                            <tr>
                                <td><div align="right"><em class="must-input">*</em><strong>性别：</strong></div></td>
                                <td colspan="3">
                                    <label class="am-radio-inline">
                                        <input type="radio" name="sex" class="sex_default1" value="1" data-am-ucheck> 男
                                    </label>
                                    <label class="am-radio-inline">
                                        <input type="radio" name="sex" class="sex_default2" value="2" data-am-ucheck> 女
                                    </label>
                                    <script type="text/javascript">
                                        $(function(){
                                            if(1 == {$info['sex']}) $('.sex_default1').attr('checked', true);
                                            if(2 == {$info['sex']}) $('.sex_default2').attr('checked', true);
                                        });
                                    </script>
                                </td>
                            </tr>
                            <tr>
                                <td><div align="right"><strong>第一学历：</strong></div></td>
                                <td colspan="3">
                                    <select name="first_degree" id="first_degree" data-am-selected="{maxHeight: 200}">
                                        <option value="">请选择第一学历</option>
                                        <foreach name="edu_list" item="v">
                                            <option value="{$v['education_name']}" <if condition="$v.education_name eq $info['first_degree']">selected</if>>{$v['education_name']}</option>
                                        </foreach>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td><div align="right"><strong>第二学历：</strong></div></td>
                                <td colspan="3">
                                    <select name="second_degree" id="second_degree" data-am-selected="{maxHeight: 200}">
                                        <option value="">请选择第二学历</option>
                                        <foreach name="edu_list" item="v">
                                            <option value="{$v['education_name']}" <if condition="$v.education_name eq $info['second_degree']">selected</if>>{$v['education_name']}</option>
                                        </foreach>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td><div align="right"><strong>语言能力[多选]：</strong></div></td>
                                <td colspan="3">
                                    <select name="language_ability[]" id="language_ability" data-am-selected="" multiple="multiple">
                                        <option value="">请选择语言能力</option>
                                        <foreach name="lang" item="v">
                                            <option value="{$v['name']}" <if condition="$v['sel'] eq 1">selected</if>>{$v['name']}</option>
                                        </foreach>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td><div align="right"><strong>详细地址：</strong></div></td>
                                <td colspan="3">
                                    <div class="am-form-group" id="address_address">
                                        <select name="t_province"></select>
                                        <select name="t_job_area"></select>
                                        <select name="t_county"></select>
                                    </div><input type="text" id="address" name="address" value="{$info['address']}" style="width:500px" placeholder="请填写详细地址" /></td>
                            </tr>
                            <tr>
                                <td><div align="right"><strong>岗位性质：</strong></div></td>
                                <td colspan="3">
                                    <select name="post_nature" id="post_nature" data-am-selected="{searchBox: 0}">
                                        <option value="">请选择</option>
                                        <foreach name="nature" item="v">
                                            <option value="{$v['name']}" <if condition="$v.name eq $info['post_nature']">selected</if>>{$v['name']}</option>
                                        </foreach>
                                    </select>
                                </td>
                            </tr>

                            <tr>
                                <td><div align="right"><em class="must-input">*</em><strong>工作地区：</strong></div></td>
                                <td colspan="3"><div class="am-form-group" id="start_address">
                                    <select name="province"></select>
                                    <select name="job_area"></select>
                                    <select name="county"></select>
                                </div></td>
                            </tr>

                            <tr>
                                <td><div align="right"><strong>行业属性：</strong></div></td>
                                <td colspan="3">
                                    <select name="industry_id" id="industry_id" data-am-selected="{searchBox: 0}" >
                                        <option value="">请选择行业</option>
                                        <foreach name="industry" item="v">
                                            <option value="{$v['id']}">{$v['industry_name']}</option>
                                        </foreach>
                                    </select>
                                    <script type="text/javascript">
                                        $(function(){
                                            if({$info['industry_id']} > 0){
                                                $('#industry_id').val({$info['industry_id']});
                                            }
                                        });
                                    </script>
                                </td>
                            </tr>
                            <tr>
                                <td><div align="right"><strong>求职方向：</strong></div></td>
                                <td colspan="3">
                                    <select data-am-selected="{searchBox: 1, maxHeight: '180px'}" style="display: none;" name="parent_id" id="parent_id">
                                    </select>
                                    <select data-am-selected="{searchBox: 1, maxHeight: '180px'}" style="display: none;" name="position_id" id="position_id">
                                    </select>
                                </td>
                            </tr>

                            <tr>
                                <td><div align="right"><strong>自我介绍：</strong></div></td>
                                <td colspan="3">
                                    <!--<script id="content1" name="introduced" type="text/plain">{$info["introduced"]|htmlspecialchars_decode}</script>-->
                                    <textarea name="introduced" id="" cols="100" rows="10">{$info['introduced']}</textarea>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="4" align="center">
                                    <input type="hidden" id="resume_id_class" name="resume_id" value="{$info['id']}">
                                    <button type="submit" id="submit_class" class="am-btn am-btn-primary tpl-btn-bg-color-success ">提交</button>
                                    <button type="button" class="am-btn am-btn-primary am-btn-warning " onclick="goback1();">返回</button>
                                </td>
                            </tr>
                        </tbody>
                            <thead>
                                <tr><th colspan="4">教育经历</th></tr>
                            </thead>
                            <tbody>
                            <empty name="resume_edu_list">
                                <tr>
                                    <td>
                                        <div align="right"><strong>教育经历</strong></div>
                                    </td>
                                    <td colspan="3">
                                        暂无
                                    </td>
                                </tr>
                            </empty>
                            <notempty name="resume_edu_list">
                                <foreach name="resume_edu_list" item="v">
                                    <tr>
                                        <td style="width: 25%;"><div align="right"><strong>学校/学历：</strong></div></td>
                                        <td style="width: 25%;">{$v['school_name']}&nbsp;&nbsp;|&nbsp;&nbsp;{$v['degree']}</td>
                                        <td><div align="right"><strong>时间：</strong></div></td>
                                        <td>{$v['starttime']}&nbsp;&nbsp;-&nbsp;&nbsp;{$v['endtime']}</td>
                                    </tr>
                                    <tr>
                                        <td><div align="right"><strong>专业/描述：</strong></div></td>
                                        <td><span style="color: #ff6e04">{$v['major']}</span>&nbsp;&nbsp;|&nbsp;&nbsp;{$v['describe']}</td>
                                        <td colspan="2">
                                            <a href="javascript:;" data-url="{:U('ResumeEdu/editResumeEdu',array('id'=>$v['id']))}" class="increase_resume_edu1">
                                            <i class="am-icon-pencil">编辑</i>
                                            </a>
                                            <a href="javascript:;" data-url="{:U('ResumeEdu/delResumeEdu',array('id'=>$v['id']))}" class="delete_resume_edu">
                                                <i class="am-icon-recycle">删除</i>
                                            </a>
                                        </td>
                                    </tr>
                                </foreach>
                            </notempty>
                            <tr>
                                <td colspan="4" style="text-align: center">
                                    <div class="tpl-table-black-operation">
                                        <div class="tw-dropdown-toggle" style="position:relative;display: inline; ">
                                            <a href="javascript:;" data-url="{:U('ResumeEdu/editResumeEdu', array('resume_id' => $info['id']))}" class="increase_resume_edu"> 新增教育经历 </a>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            </tbody>
                            <thead>
                                <tr><th colspan="4">工作经历</th></tr>
                            </thead>
                            <tbody>
                            <empty name="resume_work_list">
                                <tr>
                                    <td>
                                        <div align="right"><strong>工作经历</strong></div>
                                    </td>
                                    <td colspan="3">
                                        暂无
                                    </td>
                                </tr>
                            </empty>
                            <notempty name="resume_work_list">
                                <foreach name="resume_work_list" item="v">
                                    <tr>
                                        <td><div align="right"><strong>公司名称/职位：</strong></div></td>
                                        <td>{$v['company_name']}&nbsp;&nbsp;|&nbsp;&nbsp;<span style="color: #ff6e04">{$v['position']}</span></td>
                                        <td><div align="right"><strong>时间：</strong></div></td>
                                        <td>{$v['starttime']}&nbsp;&nbsp;-&nbsp;&nbsp;{$v['endtime']}</td>
                                    </tr>
                                    <tr>
                                        <td><div align="right"><strong>描述：</strong></div></td>
                                        <td>{$v['describe']}</td>
                                        <td colspan="2">
                                            <a href="javascript:;" data-url="{:U('ResumeWork/editResumeWork',array('id'=>$v['id']))}" class="increase_resume_work1">
                                                <i class="am-icon-pencil">编辑</i>
                                            </a>
                                            <a href="javascript:;" data-url="{:U('ResumeWork/delResumeWork',array('id'=>$v['id']))}" class="delete_resume_work">
                                                <i class="am-icon-recycle">删除</i>
                                            </a>
                                        </td>
                                    </tr>
                                </foreach>
                            </notempty>
                            <tr>
                                <td colspan="4" style="text-align: center">
                                    <div class="tpl-table-black-operation">
                                        <div class="tw-dropdown-toggle" style="position:relative;display: inline; ">
                                            <a href="javascript:;" data-url="" class="increase_resume_work"> 新增工作经历 </a>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="4" style="text-align: center;">
                                    <button type="button" class="am-btn am-btn-primary am-btn-warning " onclick="goback1();">返回</button>
                                </td>
                            </tr>
                            </tbody>
                    </table>
                    </form>         
                </div>
            </div>
        </div>
    </div>
</block>
<block name="script">
    <script type="text/javascript" src="__PUBLIC__/fileupload/js/vendor/jquery.ui.widget.js"></script>
    <script type="text/javascript" src="__PUBLIC__/fileupload/js/jquery.iframe-transport.js"></script>
    <script type="text/javascript" src="__PUBLIC__/fileupload/js/jquery.fileupload.js"></script>
    <script type="text/javascript" src="__ADMIN__/layDate-v5.0.9/laydate/laydate.js"></script>
    <script type="text/javascript" src="__STATIC__/js/address.js"></script>
    <script type="text/javascript" src="__PUBLIC__/ueditor/ueditor.config.js"></script>
    <script type="text/javascript" src="__PUBLIC__/ueditor/ueditor.all.min.js"></script>
    <script type="text/javascript">
        function callback(data){
            toastr(data.info);
            if(data.status == 1){
                $('#resume_id_class').val(data.data);
            }
        }
        function goback1(){
            location.href='/index.php/Hr/Resume/listHrResume';
        }
        $(function() {
            initAddress('#start_address',"{$info['job_area1']}", "{$info['job_area2']}", "{$info['job_area3']}", 1);
            initAddress('#address_address', "{$info['address1']}", "{$info['address2']}", "{$info['address3']}", 1);
            laydate.render({
                elem: '#age'
            });
            laydate.render({
                elem: '#edu_starttime'
            });
            laydate.render({
                elem: '#edu_endtime'
            });
            laydate.render({
                elem: '#work_starttime'
            });
            laydate.render({
                elem: '#work_endtime'
            });
            initPosition({$info['industry_id']});
            $('#industry_id').change(function(){
                initPosition($(this).val());
            });
            function initPosition(industry_id){
                if(industry_id > 0){
                    $.post("/index.php/Hr/Position/getPositionList", {industry_id: industry_id}, function (data) {
                        $('#parent_id').html('<option data-id="0" value="0">一级菜单</option>');
                        var dataLen = data.data.length;
                        var parent_sel = 0;
                        for (var i = 0; i < dataLen; i++) {
                            if({$info['position_parent']} > 0 && data.data[i].id == {$info['position_parent']}){
                                parent_sel = 'selected';
                            }
                            else{
                                parent_sel = '';
                            }
                            $('#parent_id').append('<option data-id="' + data.data[i].id
                                + '" value="' + data.data[i].id + '" '+parent_sel+'>'
                                + data.data[i].position_name + '</option>');
                        }
                        initPositionChildren({$info['position_parent']});
                    });
                }
            }

            $('#parent_id').change(function(){
                initPositionChildren($(this).val());
            });

            function initPositionChildren(position_id){
                if(position_id > 0){
                    $.post("/index.php/Hr/Position/getPositionChildrenList", {position_id: position_id}, function (data) {
                        $('#position_id').html('<option data-id="0" value="">请选择</option>');
                        var dataLen = data.data.length;
                        var parent_sel = '';
                        for (var i = 0; i < dataLen; i++) {
                            if(data.data[i].id == {$info['position_id']}){
                                parent_sel = 'selected';
                            }
                            else{
                                parent_sel = '';
                            }
                            $('#position_id').append('<option data-id="' + data.data[i].id
                                + '" value="' + data.data[i].id + '" '+parent_sel+'>'
                                + data.data[i].position_name + '</option>');
                        }
                    });
                }
            }
            $('.delete_resume_edu').click(function(){
                if(confirm('确认删除该教育经历？')){
                    $.get($(this).data('url'), {}, function(data){toastr(data.info);if(data.status == 1) location.reload();});
                }
            });
            $('.delete_resume_work').click(function(){
                if(confirm('确认删除该工作经历？')){
                    $.get($(this).data('url'), {}, function(data){toastr(data.info);if(data.status == 1) location.reload();});
                }
            });
            $('.increase_resume_work').click(function(){
                var url = '/index.php/Hr/ResumeWork/editResumeWork/resume_id/'+$('#resume_id_class').val();
                layer.open({
                    type: 2,
                    title: '新增工作经历',
                    shadeClose: false,
                    shade: 0.5,
                    area: ['80%', '80%'],
                    content: url
                });
            });
            $('.increase_resume_work1').click(function(){
                var url = $(this).data('url');
                layer.open({
                    type: 2,
                    title: '编辑工作经历',
                    shadeClose: false,
                    shade: 0.5,
                    area: ['80%', '80%'],
                    content: url
                });
            });
            $('.increase_resume_edu').click(function(){
                var url ='/index.php/Hr/ResumeEdu/editResumeEdu/resume_id/'+$('#resume_id_class').val();
                layer.open({
                    type: 2,
                    title: '新增教育经历',
                    shadeClose: false,
                    shade: 0.5,
                    area: ['80%', '80%'],
                    content: url
                });
            });
            $('.increase_resume_edu1').click(function(){
                var url = $(this).data('url');
                layer.open({
                    type: 2,
                    title: '编辑教育经历',
                    shadeClose: false,
                    shade: 0.5,
                    area: ['80%', '80%'],
                    content: url
                });
            });
        });
    </script>
</block>